<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDBMS to Graph RAG System</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>🏥 RDBMS to Graph RAG System</h1>
            <p>Intelligent database migration and natural language querying</p>
        </div>
    </div>

    <div class="container">
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('query', event)">💬 Query</button>
            <button class="nav-tab" onclick="switchTab('databases', event)">🗄️ Databases</button>
            <button class="nav-tab" onclick="switchTab('admin', event)">⚙️ Admin</button>
            <button class="nav-tab" onclick="switchTab('about', event)">ℹ️ About</button>
        </div>

        <!-- Query Tab -->
        <div id="query" class="tab-content active">
            <div class="card">
                <div class="card-header">Ask a Question</div>
                
                <div class="query-box">
                    <input 
                        type="text" 
                        id="queryInput" 
                        class="query-input" 
                        placeholder="Ask anything about your data... (e.g., 'Which doctors work in Cardiology?')"
                    >
                    <button class="btn btn-primary" onclick="executeQuery()">
                        🔍 Search
                    </button>
                </div>

                <div style="margin-bottom: 20px;">
                    <strong>Sample Queries:</strong>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;">
                        <button class="btn" style="background: #f3f4f6; color: #374151;" 
                                onclick="loadSampleQuery('Which doctors work in the Cardiology department?')">
                            Cardiology Doctors
                        </button>
                        <button class="btn" style="background: #f3f4f6; color: #374151;" 
                                onclick="loadSampleQuery('Show me patients with O+ blood type')">
                            O+ Patients
                        </button>
                        <button class="btn" style="background: #f3f4f6; color: #374151;" 
                                onclick="loadSampleQuery('What is John Smith\\'s medical history?')">
                            Patient History
                        </button>
                        <button class="btn" style="background: #f3f4f6; color: #374151;" 
                                onclick="loadSampleQuery('Which department has the most appointments?')">
                            Department Workload
                        </button>
                    </div>
                </div>
            </div>

            <div id="queryResults">
                <div class="status-message status-info">
                    💡 Enter a question above to get started
                </div>
            </div>
        </div>

        <!-- Databases Tab -->
        <div id="databases" class="tab-content">
            <!-- Active Database -->
            <div class="card">
                <div class="card-header">🎯 Active Database</div>
                <div id="activeDatabaseDisplay" style="padding: 16px; background: #f9fafb; border-radius: 4px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div id="activeDbInfo">
                            <strong>Loading...</strong>
                        </div>
                        <button class="btn btn-secondary" onclick="loadDatabases()" style="padding: 8px 16px;">
                            🔄 Refresh
                        </button>
                    </div>
                </div>
            </div>

            <!-- Database List -->
            <div class="card">
                <div class="card-header">📚 Configured Databases</div>
                <div id="databaseList" style="margin-top: 16px;">
                    <div class="status-message status-info">Loading databases...</div>
                </div>
            </div>

            <!-- Add New Database -->
            <div class="card">
                <div class="card-header">➕ Add New Database</div>

                <div class="form-group">
                    <label class="form-label">Database Name</label>
                    <input type="text" id="newDbName" class="form-input" placeholder="e.g., My E-commerce DB">
                </div>

                <div class="form-group">
                    <label class="form-label">Database Type</label>
                    <select id="newDbType" class="form-select">
                        <option value="postgres">PostgreSQL</option>
                        <option value="mysql">MySQL</option>
                        <option value="sqlite">SQLite</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Domain Prefix</label>
                    <input type="text" id="newDbPrefix" class="form-input" placeholder="e.g., Ecommerce">
                </div>

                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" id="newDbDescription" class="form-input" placeholder="Brief description">
                </div>

                <div id="newDbConnectionFields">
                    <!-- Connection fields will be dynamically added based on db type -->
                </div>

                <button class="btn btn-primary" onclick="addNewDatabase()">
                    ➕ Add Database
                </button>

                <div id="addDbStatus" style="margin-top: 16px;"></div>
            </div>
        </div>

        <!-- Admin Tab -->
        <div id="admin" class="tab-content">
            <!-- Database Migration -->
            <div class="card">
                <div class="card-header">📊 Database Migration</div>
                
                <div class="form-group">
                    <label class="form-label">Database Type</label>
                    <select id="dbType" class="form-select">
                        <option value="postgres">PostgreSQL</option>
                        <option value="mysql">MySQL</option>
                        <option value="sqlite">SQLite</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Domain Prefix (optional)</label>
                    <input 
                        type="text" 
                        id="domainPrefix" 
                        class="form-input" 
                        placeholder="e.g., Healthcare, Ecommerce"
                    >
                    <small style="color: var(--text-secondary);">
                        Add a prefix to separate different domains in the same graph database
                    </small>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="clearTarget" checked>
                        <span>Clear existing graph data before migration</span>
                    </label>
                </div>

                <button class="btn btn-primary" onclick="migrateDatabase()">
                    🚀 Start Migration
                </button>

                <div id="migrateStatus" style="margin-top: 16px;"></div>
            </div>

            <!-- Embeddings -->
            <div class="card">
                <div class="card-header">🧠 Vector Store Status</div>

                <div id="vectorStoreStatus" style="margin-bottom: 16px; padding: 12px; background: #f5f5f5; border-radius: 4px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>Status:</strong> <span id="vsStatus">Loading...</span><br>
                            <strong>Vectors:</strong> <span id="vsSize">0</span><br>
                            <strong>Auto-save:</strong> <span id="vsAutoSave">Enabled</span>
                        </div>
                        <button class="btn btn-secondary" onclick="checkVectorStoreStatus()" style="padding: 8px 16px;">
                            🔄 Refresh
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Node Labels (comma-separated, leave empty for all)</label>
                    <input
                        type="text"
                        id="nodeLabels"
                        class="form-input"
                        placeholder="e.g., Healthcare_Patient, Healthcare_Doctor"
                    >
                </div>

                <button class="btn btn-success" onclick="buildEmbeddings()">
                    ⚡ Build Embeddings
                </button>

                <div id="embeddingStatus" style="margin-top: 16px;"></div>
            </div>

            <!-- Statistics -->
            <div class="card">
                <div class="card-header">📈 Database Statistics</div>
                <div id="statsDisplay">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <!-- About Tab -->
        <div id="about" class="tab-content">
            <div class="card">
                <div class="card-header">About This System</div>
                
                <h3 style="margin-top: 20px;">🎯 Features</h3>
                <ul style="line-height: 2;">
                    <li><strong>Multi-Database Support:</strong> PostgreSQL, MySQL, SQLite</li>
                    <li><strong>Automatic Schema Mapping:</strong> Converts relational schemas to graph models</li>
                    <li><strong>Domain Prefixes:</strong> Support multiple databases in one graph</li>
                    <li><strong>Semantic Search:</strong> OpenAI embeddings for intelligent retrieval</li>
                    <li><strong>Natural Language Queries:</strong> Ask questions in plain English</li>
                    <li><strong>RAG System:</strong> Retrieval-Augmented Generation with LangGraph</li>
                </ul>

                <h3 style="margin-top: 20px;">🏗️ Architecture</h3>
                <ul style="line-height: 2;">
                    <li><strong>Backend:</strong> Python, FastAPI, LangGraph, LangChain</li>
                    <li><strong>Graph Database:</strong> Neo4j</li>
                    <li><strong>Vector Store:</strong> FAISS</li>
                    <li><strong>LLM:</strong> OpenAI GPT-4o-mini</li>
                    <li><strong>Embeddings:</strong> OpenAI text-embedding-3-small</li>
                </ul>

                <h3 style="margin-top: 20px;">📖 How to Use</h3>
                <ol style="line-height: 2;">
                    <li>Go to <strong>Admin</strong> tab</li>
                    <li>Select your database type and domain prefix</li>
                    <li>Click <strong>Start Migration</strong> to load your data</li>
                    <li>Click <strong>Build Embeddings</strong> for semantic search</li>
                    <li>Go to <strong>Query</strong> tab and ask questions!</li>
                </ol>

                <h3 style="margin-top: 20px;">💡 Example Queries</h3>
                <ul style="line-height: 2;">
                    <li>"Which doctors work in the Cardiology department?"</li>
                    <li>"Show me all patients with O+ blood type"</li>
                    <li>"What is John Smith's medical history?"</li>
                    <li>"Which department has the most appointments?"</li>
                    <li>"Find doctors with more than 15 years of experience"</li>
                    <li>"Show me a patient journey for heart-related issues"</li>
                </ul>

                <div style="margin-top: 30px; padding: 20px; background: #f3f4f6; border-radius: 8px;">
                    <strong>🚀 Built for Hackathon Submission</strong><br>
                    <p style="margin-top: 10px; color: var(--text-secondary);">
                        This system demonstrates advanced RAG capabilities with multi-database support,
                        intelligent schema mapping, and agentic retrieval workflows.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>

